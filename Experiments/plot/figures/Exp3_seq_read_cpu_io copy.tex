\makeatletter
\newcommand\resetstackedplots{
	\makeatletter
	\pgfplots@stacked@isfirstplottrue
	\makeatother
	\addplot [forget plot,draw=none] coordinates{({HandCodedCPP},1) ({inPlaceCPP},1) ({FlatBuffersCPP},1) ({ProtoBufCPP},1) ({BoostCPP},1) ({BsonCPP},1) ({MessagePackRust},1) ({BincodeRust},1) ({JsonRust},1) ({FlexBuffersRust},1) ({BsonRust},1) ({Json+GzipJava},1) ({JsonJava},1) ({BsonJava},1) ({DefaultJava},1) ({ProtoBufJava},1) ({Byte BufferJava},1) ({FlatBuffersJava},1) ({KryoJava},1)};
}
\makeatother


\begin{tikzpicture}
	\newcommand{\myaddplot}[8]{
	   \addplot[xshift=#2,draw=#5,line width=0.15pt, fill=#3, discard if single={#1}{#4}{#8}, postaction={pattern=#6,pattern color=#5}] 
	   table[ y=time, col sep=comma, x=baseline] {results/Exp3_seq_read_cpu_io.dat};
	   %\addlegendentry{#7};
   };  
   
   \newcommand{\myaddplots}[6]{	   
	\addplot[xshift=#2,draw=#5,line width=0.15pt, fill=#3, discard if single={#1}{#4}{#6},
		forget plot,
		nodes near coords custom=1,
		every node near coord/.append style={
			black,			
			xshift=-10pt,
			anchor=west
		}
	] 
	table[ y=time, col sep=comma, x=baseline] {results/Exp3_seq_read_cpu_io.dat};	
   };   
   
   \newcommand{\addDiagramExpOne}[3]{	
		\resetstackedplots	
		\myaddplot{TRUE}{-5}{#2}{IO}{#2}{none}{I/O Time(taskset True)}{#1};
  		\myaddplot{TRUE}{-5}{#2!40}{CPU}{#2!40}{north east lines}{CPU Time(taskset True)}{#1};
		\myaddplots{TRUE}{-5}{white}{Total}{none}{#1};
	    \resetstackedplots	 
		\myaddplot{FALSE}{5}{#3}{IO}{#3}{none}{I/O Time(taskset False)}{#1};  
	    \myaddplot{FALSE}{5}{#3!40}{CPU}{#3!40}{north west lines}{CPU Time(taskset False)}{#1};
		\myaddplots{FALSE}{5}{white}{Total}{none}{#1};
	    
   };     


   \pgfplotsset{
	   discard if single/.style n args={3}{
		   x filter/.code={
			   \edef\tempa{\thisrow{taskset}}
			   \edef\tempb{#1}
			   \ifx\tempa\tempb
					   \edef\tempe{\thisrow{execution}}
					   \edef\tempf{#2}
					   \ifx\tempe\tempf	
					   	%%%%%%%%%%%%%%%%%%%
						   \edef\tempg{\thisrow{language}}
						   \edef\temph{#3}
						   \ifx\tempg\temph		
						   \else
						   \def\pgfmathresult{inf}
						   \fi      
						%%%%%%%%%%%%%%%%%%%	
					   \else
					   \def\pgfmathresult{inf}
					   \fi      
			   \else
			   \def\pgfmathresult{inf}
			   \fi			
		   }
	   },
	   nodes near coords custom/.style={
		large value/.style={                    
			rotate=90,
			anchor=east,			
		},
		small value/.style={
			rotate=90,
			anchor=east,
		},
		every node near coord/.style={
		  font=\scriptsize,
		  inner sep=0.5mm,
		  /pgf/number format/1000 sep={},
		  check for zero/.code={%
			\pgfkeys{/pgf/fpu=true}
			\pgfmathparse{\pgfplotspointmeta-1}
			\pgfmathfloatifflags{\pgfmathresult}{0}{
				\pgfkeys{/tikz/coordinate}
			}{
				\begingroup                      
					\pgfkeys{/pgf/fpu}%
					\pgfmathparse{\pgfplotspointmeta<#1}%
					\global\let\result=\pgfmathresult
				\endgroup
				\pgfmathfloatcreate{1}{1.0}{0}%
				\let\ONE=\pgfmathresult
				\ifx\result\ONE
					% AH : our condition 'y < #1' is met.
					\pgfkeysalso{/pgfplots/small value}%
				\else
					% ok, proceed as usual.
					\pgfkeysalso{/pgfplots/large value}%
				\fi
			}
			\pgfkeys{/pgf/fpu=false}
		  },
		  check for zero,
		},
	},   
   };
   
   
	   \begin{axis}[
			name=ax,
		   %xtick style={draw=none},		
			 every major tick/.append style={ thick,major tick length=2.5pt, gray},
			axis line style={gray},
		    ybar stacked,        
		   ymode=log,
		   ymin=5,
		   y tick label style={/pgf/number format/1000 sep={}},
		   x tick label style={/pgf/number format/1000 sep={}},
		   %scaled y ticks=false,
		   enlarge y limits={0.2,upper},
		   enlarge x limits=0.03,
		   ylabel={Execution Time[s] - Log},		   
		   ytick align=inside,
		   xtick align=outside,
		   xtick pos=left,
		   ytick pos=left,
		   yticklabel style = {font=\scriptsize},
		   ylabel style = {font=\scriptsize, yshift=-12pt},
		   xticklabel style = {font=\scriptsize, rotate=20, anchor=east, xshift=2pt, yshift=-2pt},
		   xtick=data,
		   height=0.6\columnwidth,  
		   bar width=10pt,
		   width=1\textwidth,   
		   ymajorgrids=true,
		   grid style=dotted,   
		   minor grid style={gray!50},  
		   symbolic x coords={ HandCodedCPP, inPlaceCPP, FlatBuffersCPP, ProtoBufCPP, BoostCPP, BsonCPP, MessagePackRust, BincodeRust, JsonRust, FlexBuffersRust, BsonRust, Json+GzipJava, JsonJava, BsonJava, DefaultJava, ProtoBufJava, Byte BufferJava, FlatBuffersJava, KryoJava},   
		   xticklabels={ HandCoded, inPlace, FlatBuffers, ProtoBuf, Boost, Bson, MessagePack, Bincode, Json, FlexBuffers, Bson, Json+Gzip, Json, Bson, Default, 			  ProtoBuf, Byte Buffer, FlatBuffers, Kryo},    
		   point meta=rawy,            
           nodes near coords={\pgfmathprintnumber[precision=1]{\pgfplotspointmeta}},
           nodes near coords custom={101}, 
		% 	legend image code/.code={\draw [#1] (0cm,-0.1cm) rectangle (0.25cm,0.3cm); },					   
		% 	legend style = {
		% 		every column/.append style   = {column sep=0.5cm, text width=30pt, draw=black},
        %     	font=\small,
		% 		%anchor=black,
        %     	draw=none,
		% 		legend columns=-1,
		% 		anchor=north,
		% 		legend cell align=left
        % 	},
       	% 	legend pos = {north west},
		% 	   every axis plot/.append style={
		% 		%ybar,
		% 		%bar width=.2,
		% 		bar shift=0pt,
		% 		fill
        % }, 
		   ]  	  
		   \addDiagramExpOne{CPP}{tug}{orange};		
		   \addDiagramExpOne{Rust}{tugb}{color7};	
		   \addDiagramExpOne{Java}{color5}{color2};			
	   \end{axis}	
	   \coordinate (c-0-0) at (ax.south west);
	   
	   %\draw[very thick] (c-0-5) -- (c-5-5);
	   
	 \end{tikzpicture}